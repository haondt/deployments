components:
  primary:
    image: registry.gitlab.com/haondt/cicd/registry/jobs:0.0.1
    talos: x
    networking:
      ports:
        http: 1880
      gateway.http_routes:
        - port: http
          host: "jobs.{{ haondt__default_host }}"
      dependencies:
        - name: redis
          port: http
    volumes:
      node-red-settings:
        src.file: settings.js
        dest.file: /data/settings.js
      node-red-data:
        src.pvc: {}
        dest.dir: /data
    environment:
      - file: jobs.env
        secret: true

  redis:
    image: docker.io/library/redis:latest@sha256:7b6fb55d8b0adcd77269dc52b3cfffe5f59ca5d43dec3c90dbe18aacce7942e1
    talos: +!
    networking:
      ports:
        http: 6379
    volumes:
      redis-data:
        src.pvc: {}
        dest.dir: /data

  redis-insight:
    image: docker.io/redis/redisinsight:latest@sha256:4455c3304eafe1311d0a367022bad41520e307138b7272e1c0c308ce781f7162
    talos: +!
    networking:
      ports:
        http: 5540
      gateway.http_routes:
        - port: http
          host: "jobs-redis.{{ haondt__default_host }}"
      dependencies:
        - name: redis
          port: http
    volumes:
      redis-insight-data:
        src.pvc: {}
        dest.dir: /data
