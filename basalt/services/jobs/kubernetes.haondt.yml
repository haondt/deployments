components:
  primary:
    image: registry.gitlab.com/haondt/cicd/registry/jobs:0.0.1
    talos: x
    networking:
      ports:
        http: 1880
      ingresses:
        - port: http
          host: "jobs.{{ haondt__default_host }}"
          tls.host: "*.{{ haondt__default_host }}"
      dependencies:
        - name: redis
          port: http
    volumes:
      node-red-settings:
        src.file: settings.js
        dest.file: /data/settings.js
      node-red-data:
        src.pvc: {}
        dest.dir: /data
    environment:
      - file: jobs.env
        secret: true
  redis:
    image: docker.io/library/redis:latest@sha256:47200b04138293fae39737e50878a238b13ec0781083126b1b0c63cf5d992e8d
    talos: +!
    networking:
      ports:
        http: 6379
    volumes:
      redis-data:
        src.pvc: {}
        dest.dir: /data
  redis-insight:
    image: docker.io/redis/redisinsight:latest@sha256:b2034915b9eeb0cea5a52e8ed06b22761ce2438e93762d66f5320506d56bfc8c
    talos: +!
    networking:
      ports:
        http: 5540
      ingresses:
        - port: http
          host: "jobs-redis.{{ haondt__default_host }}"
          tls.host: "*.{{ haondt__default_host }}"
      dependencies:
        - name: redis
          port: http
    volumes:
      redis-insight-data:
        src.pvc: {}
        dest.dir: /data
