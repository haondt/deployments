components:
  primary:
    image: registry.gitlab.com/haondt/cicd/registry/jobs:0.0.1
    talos: x
    networking:
      ports:
        http: 1880
      ingresses:
        - port: http
          host: "jobs.{{ haondt__default_host }}"
          tls.host: "*.{{ haondt__default_host }}"
      dependencies:
        - name: redis
          port: http
    volumes:
      node-red-settings:
        src.file: settings.js
        dest.file: /data/settings.js
      node-red-data:
        src.pvc: {}
        dest.dir: /data
    environment:
      - file: jobs.env
        secret: true
  redis:
    image: docker.io/library/redis:latest@sha256:4521b581dbddea6e7d81f8fe95ede93f5648aaa66a9dacd581611bf6fe7527bd
    talos: +!
    networking:
      ports:
        http: 6379
    volumes:
      redis-data:
        src.pvc: {}
        dest.dir: /data
  redis-insight:
    image: docker.io/redis/redisinsight:latest@sha256:b7aa18e73329ebb2e3d9e949b8d35193bf5415ef35c16fd9a50e6f832922b296
    talos: +!
    networking:
      ports:
        http: 5540
      ingresses:
        - port: http
          host: "jobs-redis.{{ haondt__default_host }}"
          tls.host: "*.{{ haondt__default_host }}"
      dependencies:
        - name: redis
          port: http
    volumes:
      redis-insight-data:
        src.pvc: {}
        dest.dir: /data
