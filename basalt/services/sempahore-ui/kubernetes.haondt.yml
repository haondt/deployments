components:
  primary:
    image: public.ecr.aws/semaphore/pro/server:v2.16.36@sha256:c39b27caf2b4a648a8aa38b13622a9deb5b63dca98c87089b1fc51a2ed99a0d8
    talos: '^!'
    networking:
      ports:
        http: 3000
      ingresses:
        - port: http
          host: "semaphore.{{ haondt__default_host }}"
    volumes:
      data:
        src.pvc.size: 2Gi
        dest.dir: /var/lib/semaphore
      config:
        src.pvc.size: 1Gi
        dest.dir: /etc/semaphore
      cache:
        src.pvc.size: 2Gi
        dest.dir: /tmp/semaphore
    startup:
      tasks:
        - chmod:
            paths: [/var/lib/semaphore,/etc/semaphore,/tmp/semaphore]
            mode: '0777'
    environment:
      - raw:
          SEMAPHORE_DB_DIALECT: sqlite
          SEMAPHORE_ADMIN: admin
          SEMAPHORE_ADMIN_PASSWORD: admin
          SEMAPHORE_ADMIN_NAME: Admin
          SEMAPHORE_ADMIN_EMAIL: admin@localhost
