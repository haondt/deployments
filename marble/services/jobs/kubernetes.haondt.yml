components:
  primary:
    image: registry.gitlab.com/haondt/cicd/registry/jobs:0.0.1
    x-tl: x
    networking:
      ports:
        http: 1880
      ingresses:
        - port: http
          host: "jobs.{{ haondt__default_host }}"
          tls.host: "*.{{ haondt__default_host }}"
    volumes:
      node-red-settings:
        src.file: settings.js
        dest.file: /data/settings.js
      node-red-data:
        src.pvc: {}
        dest.dir: /data
    startup:
      tasks:
        - chown:
            paths: [/data]
            owner: 1000:1000
    environment:
      - file: jobs.env
        secret: true
