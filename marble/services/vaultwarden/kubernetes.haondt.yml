components:
  primary:
    image: docker.io/vaultwarden/server:1.34.3@sha256:84fd8a47f58d79a1ad824c27be0a9492750c0fa5216b35c749863093bfa3c3d7
    talos: "+:!!!?"
    networking:
      ports:
        http: 80
      ingresses:
        - port: http
          host: "vaultwarden.{{ haondt__default_host }}"
          tls.host: "*.{{ haondt__default_host }}"
    observability:
      probes.hc:
        http_get:
          port: http
          path: /alive
        alloy.blackbox: {}
    volumes:
      data:
        src.pvc: {}
        dest.dir: /data
    charon:
      - overlays: [default-gcs, daily]
        repository_configs: &charon_repository_configs
          - raw: |-
              backend:
                path: vaultwarden-primary
        source.volumes: &charon_source
          data: [/]
      - overlays: [default-hzsb, daily]
        repository_configs: *charon_repository_configs
        source.volumes: *charon_source
