components:
  primary:
    image: lscr.io/linuxserver/syncthing:latest@sha256:97b4d8e75d44ef19f7a015800d318c1c307c0a245949a080fd146226b597f85b
    talos: +!
    networking:
      ports:
        http.port: 8384
        st1.port: 22000
        st2:
          port: 22000
          protocol: udp
        st3:
          port: 21027
          protocol: udp
      ingresses:
        - port: http
          host: "syncthing.{{ haondt__default_host }}"
          tls.host: "*.{{ haondt__default_host }}"
      ip_addresses:
        - ip: 192.168.1.103
          ports: [http,st1,st2,st3]
    observability:
      probes.hc:
        http_get:
          port: http
          path: /rest/noauth/health
        alloy.blackbox: {}
    volumes:
      config:
        src.pvc.size: 64Mi
        dest.dir: /config
      data:
        src.pvc.size: 1Gi
        dest.dir: /data
    startup:
      tasks:
        - chown:
            paths: [/data,/config]
            owner: 911:1000
    environment:
      - raw:
          PUID: 911
          PGID: 1000
    charon:
      - overlays: [default-gcs, daily]
        repository_configs: &charon_repository_configs
          - raw: |-
              backend:
                path: deployments-syncthing
        source.volumes: &charon_source
          data: [/]
      - overlays: [default-hzsb, daily]
        repository_configs: *charon_repository_configs
        source.volumes: *charon_source
