components:
  primary:
    image: docker.io/library/wordpress:latest@sha256:d58bf36cd0911273190beb740d8c7fad5fa30f35a4198131deb11573709ad4c1
    talos: +!
    networking:
      ports:
        http: 80
      dependencies:
        - name: db
          port: http
      rathole_routes:
        - port: http
          host: "{{ aeeo__domain }}"
    volumes:
      config:
        src.pvc: {}
        dest.dir: /var/www/html
    environment:
      - raw:
          WORDPRESS_DB_HOST: aeeo-wordpress-db-http:8080
          WORDPRESS_DB_USER: aeeowordpress
          WORDPRESS_DB_PASSWORD: aeeowordpress
          WORDPRESS_DB_NAME: aeeowordpress
  db:
    image: docker.io/library/mariadb:12@sha256:5b6a1eac15b85b981a61afb89aea2a22bf76b5f58809d05f0bcc13ab6ec44cb8
    talos: ^!
    args: ['--default-authentication-plugin=mysql_native_password']
    networking:
      ports:
        http: 3306
    volumes:
      db-data:
        src.pvc: {}
        dest.dir: /var/lib/mysql
    environment:
      - raw: 
          MYSQL_ROOT_PASSWORD: aeeowordpress
          MYSQL_DATABASE: aeeowordpress
          MYSQL_USER: aeeowordpress
          MYSQL_PASSWORD: aeeowordpress
