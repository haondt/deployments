components:
  primary:
    image: registry.gitlab.com/haondt/cicd/registry/hestia:0.1.1
    talos: x
    networking:
      ports.http: 8080
      ingresses:
        - port: http
          host: "hestia.{{ haondt__default_host }}"
          nginx.proxy_body_size: 128m
    environment:
      - file: hestia.env
        secret: true
    volumes:
      data:
        src.pvc.size: 1Gi
        dest.dir: /data
      credentials:
        src:
          file: credentials.json
          secret: true
        dest.file: /config/gcp_credentials.json
    startup:
      tasks:
        - chmod:
            path: /data
            mode: '777'
    charon:
      overlays: [weekly]
      backups:
        - overlays: [default-hzsb]
          repository_configs:
            - raw: |-
                backend:
                  path: deployments-hestia
          source.volumes:
            data: [/]

