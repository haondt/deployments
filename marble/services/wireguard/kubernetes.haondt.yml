components:
  primary:
    image: lscr.io/linuxserver/wireguard:latest@sha256:394cc1146ad854096889548c60aab91aeff8017ed757d96eb4908a7dbe46856e
    talos: +!
    
    networking:
      ports:
        udp:
          port: 51820
          protocol: UDP
      ip_addresses:
        - ip: 192.168.1.102
          ports: [udp]
    volumes:
      modules:
        src.host.dir: /lib/modules
        dest.dir: /lib/modules
      config:
        src.pvc.size: 64Mi
        dest.dir: /config
    security:
      cap.add:
        - NET_ADMIN
        - SYS_MODULE
      sysctls:
        - net.ipv4.ip_forward
    environment:
      - raw:
          SERVERPORT: 52820
          PEERS: 2
      - raw:
          SERVERURL: "{{ haondt__cluster_ip }}"
        secret: true



