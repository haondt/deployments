components:
  primary:
    image: lscr.io/linuxserver/wireguard:latest@sha256:14d1da065306c97d0a7171901221027dcbaa4be6c8731a3d8bdc54d57a92bbfe
    talos: +!
    
    networking:
      ports:
        udp:
          port: 51820
          protocol: UDP
      ip_addresses:
        - ip: 192.168.1.102
          ports: [udp]
    volumes:
      modules:
        src.host.dir: /lib/modules
        dest.dir: /lib/modules
      config:
        src.pvc.size: 64Mi
        dest.dir: /config
    security:
      cap.add:
        - NET_ADMIN
        - SYS_MODULE
      sysctls:
        - net.ipv4.ip_forward
    environment:
      - raw:
          SERVERPORT: 52820
          PEERS: 2
      - raw:
          SERVERURL: "{{ haondt__cluster_ip }}"
        secret: true



