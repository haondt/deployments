event {}

stream {
    access_log log_file log_format;
    access_log  /var/log/nginx/access.log;

    error_log log_file log_level;
    error_log  /var/log/nginx/error_log  crit;

    upstream rathole_backend {
        server rathole-server:{{ rathole__server__port }};
    }

    server {
        listen {{ rathole__server__port }};
        server_name rathole.haondt.dev;

        proxy_timeout 1m;
        proxy_connect_timeout 1s;

        # Proxy TCP traffic
        proxy_pass rathole_backend;
    }

    # Optional fallback server for invalid requests
    server {
        listen {{ rathole__server__port }};
        server_name _;

        return 503;
    }
}

